<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flashcard Quiz</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  body { font-family: Arial, sans-serif; 
    background: linear-gradient(to bottom right, #353752, #353752); 
    margin: 0; 
    padding: 20px; }

  h1 { text-align: center; 
       margin: 20px;
       margin-left: 50px; 
       margin-right: 50px; 
       font-size: 1rem; 
       color: #e0e0e0; }

  /* Sidebar */
  .sidebar { position: fixed; top: 25px; left: 0; width: 300px; background: #fff; padding: 15px; border-radius: 0 8px 8px 0; box-shadow: 0 2px 6px rgba(0,0,0,0.1); transform: translateX(calc(-100% - 15px)); transition: transform 0.3s ease; z-index: 9999; }
  .sidebar.open { transform: translateX(0); }
  .sidebar h2 { font-size: 1.4rem; margin-top: 0; color: #47549c; text-align: center; }
  .sidebar ul { list-style: none; padding: 0; margin: 0; }
  .sidebar li { margin: 20px 0; padding-left: 60px; font-size: 1rem; }
  .sidebar a { text-decoration: none; color: #111827; transition: color 0.2s; }
  .sidebar a:hover, .sidebar a.active-chapter { color: #47549c; font-weight: bold; }
  .sidebar-toggle { position: fixed; top: 20px; left: 0; font-size: 14px; background: #47549c; color: white; border: none; padding: 15px 20px; cursor: pointer; z-index: 10000; border-radius: 0 5px 5px 0; }

  #infoPanel {
    position: fixed;
    top: 80px;
    left: 0;
    width: 200px;
    background: #fff;
    padding: 15px 15px 15px 45px;
    border-radius: 0 8px 8px 0;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    z-index: 9999; }

  #infoPanel.open {
    transform: translateX(0); }


  /* Buttons */
  #shuffleBtn, #playPauseBtn { 
    width: 45px;
    height: 45px; 
    padding: 2px 2px; 
    cursor: pointer; 
    border: none; 
    border-radius: 6px; 
    background-color: #292929; 
    color: white; 
    font-weight: bold; 
    font-size: 20px; }

  /* Toggle switch */
  .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
  .switch input { display: none; }
  .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #afafaf; transition: .4s; border-radius: 10px; }
  .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 10px; }
  input:checked + .slider { background-color: #47549cd2; }
  input:checked + .slider:before { transform: translateX(26px); }

  /* Tabs */
  .tabs { display: flex; justify-content: center; gap: 10px; }
  .tabs button { padding: 10px 15px; font-size: 16px; cursor: pointer; border: none; background: white; border-radius: 5px; transition: background 0.3s; }
  .tabs button.active { background: #47549cd2; color: #fff; }

  .note-question { color: white; margin-bottom: 5px; }

  /* Progress bar */
  #progressBarContainer {
    background-color: #afafaf;
    border-radius: 10px;
    height: 20px;
    position: relative;
  }
  #progressBar {
    height: 100%;
    width: 0%;
    background-color: #3ec270;
    border-radius: 10px;
    transition: width 0.3s ease;
  }
  #progressText {
    position: absolute;
    right: 10px;
    top: 0;
    height: 100%;
    display: flex;
    align-items: center;
    color: #ffffff;
    font-weight: bold;
  }

  /* Flashcards */
  .container { display: flex; justify-content: center; align-items: center; min-height: 300px; width: 100%; flex-direction: column; }
  .card { width: 90vw; max-width: 500px; aspect-ratio: 4/3; perspective: 1000px; margin: 10px auto; }
  .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.45s; transform-style: preserve-3d; border-radius: 10px; cursor: pointer; }
  .card-inner.flipped { transform: rotateY(180deg); }
  .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 10px; display: flex; justify-content: center; align-items: center; padding: 15px; box-sizing: border-box; font-size: clamp(18px, 2vw, 24px); text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
  .card-front { background-color: #47549cd2; color: white; flex-direction: column; }
  .card-back { background-color: #47549cd2; color: white; transform: rotateY(180deg); flex-direction: column; }
  .textarea-container { display: flex; flex-direction: column; align-items: center; width: 100%; }
  .note-textarea {
    width: 100%;
    max-width: 500px;
    height: 300px;
    resize: none;
    padding: 10px;
    font-size: 1rem;
    border-radius: 10px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  textarea { margin-top: 10px; height: 100px; resize: none; }

  /* Navigation buttons */
  .nav-buttons { margin-top: 5px; text-align: center; }
  .nav-buttons button { font-size: 24px; padding: 30px 35px; margin: 0 5px; border: none; background: #47549cd2; color: white; border-radius: 5px; cursor: pointer; transition: background 0.3s; }
  .nav-buttons button:hover { background: #47549cd2; }
  .nav-buttons button:disabled { background: #afafaf21; cursor: not-allowed; }
</style>
</head>
<body>

<h1>Capital Adequacy Requirements - Guideline (2024)</h1>

<!-- Top controls container -->
<div style="display:flex; align-items:center; justify-content:center; gap:10px; margin-top:70px; margin-bottom:30px; flex-wrap: wrap;">
  <button id="shuffleBtn">⚀</button>
  <button id="playPauseBtn"><i class="fa-solid fa-play"></i></button>
  <div class="tabs" ;">
    <button id="questionsTab" class="active">Study Mode</button>
    <button id="notesTab">Notes Mode</button>
  </div>
</div>

<!-- Essentials/Details Toggle -->
<div style="display: flex; align-items: center; justify-content: center; gap: 15px; width: 90%; max-width: 500px; margin: 0 auto 20px; margin-bottom: 0px;">
  <!-- Toggle switch -->
  <label class="switch">
    <input type="checkbox" id="modeToggle">
    <span class="slider"></span>
  </label>

  <!-- Progress bar -->
  <div id="progressBarContainer" style="flex-grow: 1; position: relative;">
    <div id="progressBar"></div>
    <span id="progressText">0/0</span>
  </div>
</div>

<button class="sidebar-toggle" id="sidebarToggle">☰</button>
<div class="sidebar" id="sidebar">
  <h2>Chapters</h2>
  <ul>
    <li><a href="#chapter1">Chapter 1 – Overview</a></li>
    <li><a href="#chapter2">Chapter 2 – Definition of Capital</a></li>
    <li><a href="#chapter3">Chapter 3 – Operational Risk</a></li>
    <li><a href="#chapter4">Chapter 4 – Credit Risk – Standardized Approach</a></li>
    <li><a href="#chapter5">Chapter 5 – Credit Risk – Internal Ratings-Based Approach</a></li>
    <li><a href="#chapter6">Chapter 6 – Securitization</a></li>
    <li><a href="#chapter7">Chapter 7 – Settlement and Counterparty Risk</a></li>
    <li><a href="#chapter8">Chapter 8 – CVA Risk</a></li>
    <li><a href="#chapter9">Chapter 9 – Market Risk</a></li>
  </ul>
</div>

<button class="sidebar-toggle" id="infoToggle" style="top: 75px; left: 0; background: #47549c;">
  <i class="fa-solid fa-circle-info"></i>
</button>

<div class="sidebar" id="infoPanel" >
  <h2>Author Info</h2>
  <p><strong>Name:</strong> Gabriel Biard</p>
</div>

<div class="container" id="flashcards-container"></div>

<script>
// Elements
const container=document.getElementById('flashcards-container');
const questionsTab=document.getElementById('questionsTab');
const notesTab=document.getElementById('notesTab');
const sidebar=document.getElementById('sidebar');
const toggleBtn=document.getElementById('sidebarToggle');
const infoPanel = document.getElementById('infoPanel');
const infoToggle = document.getElementById('infoToggle');
const shuffleBtn=document.getElementById('shuffleBtn');
const progressBar=document.getElementById('progressBar');
const progressText=document.getElementById('progressText');
const playPauseBtn=document.getElementById('playPauseBtn');
const modeToggle=document.getElementById('modeToggle');

let flashcards=[], activeTab='questions', flippedCards={}, currentIndex=0;
let totalFlashcards=0, seenCount=0, playInterval=null, isPlaying=false;
let autoIndex=0, showingAnswer=false, originalChapterKey='chapter1';

// Essentials map
const chapterJSONMap_essentials={
  chapter1:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter1_essentials.json",
  chapter2:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter2_essentials.json",
  chapter3:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter3_essentials.json",
  chapter4:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter4_essentials.json",
  chapter5:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter5_essentials.json",
  chapter6:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter6_essentials.json",
  chapter7:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter7_essentials.json",
  chapter8:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter8_essentials.json",
  chapter9:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter9_essentials.json"
};

// Details map
const chapterJSONMap_details={
  chapter1:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter1_details.json",
  chapter2:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter2_details.json",
  chapter3:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter3_details.json",
  chapter4:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter4_details.json",
  chapter5:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter5_details.json",
  chapter6:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter6_details.json",
  chapter7:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter7_details.json",
  chapter8:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter8_details.json",
  chapter9:"https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter9_details.json"
};

function stopAutoOnInteraction(){
  if(isPlaying){ isPlaying=false; playPauseBtn.querySelector('i').classList.remove('fa-pause'); playPauseBtn.querySelector('i').classList.add('fa-play'); clearTimeout(playInterval); playInterval=null; }
}

// Sidebar toggle
toggleBtn.addEventListener('click', () => {
  // Close info panel if open
  if (infoPanel.classList.contains('open')) {
    infoPanel.classList.remove('open');
  }
  // Toggle sidebar
  sidebar.classList.toggle('open');
});

// Info panel toggle
infoToggle.addEventListener('click', () => {
  // Close sidebar if open
  if (sidebar.classList.contains('open')) {
    sidebar.classList.remove('open');
  }
  // Toggle info panel
  infoPanel.classList.toggle('open');
});

// Load initial chapter
loadChapter(originalChapterKey);

// Sidebar chapter selection
document.querySelectorAll('.sidebar a').forEach(link=>{
  link.addEventListener('click', e=>{
    e.preventDefault();
    stopAutoOnInteraction();
    originalChapterKey=link.getAttribute('href').substring(1);
    loadChapter(originalChapterKey);
    document.querySelectorAll('.sidebar a').forEach(l=>l.classList.remove('active-chapter'));
    link.classList.add('active-chapter');
    sidebar.classList.remove('open');
  });
});

// Shuffle logic
function shuffleArray(array){ for(let i=array.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [array[i],array[j]]=[array[j],array[i]]; } }
shuffleBtn.addEventListener('click', ()=>{ stopAutoOnInteraction(); shuffleArray(flashcards); currentIndex=0; flippedCards={}; seenCount=0; autoIndex=0; showingAnswer=false; renderFlashcards(); });

// Play/pause logic
playPauseBtn.addEventListener('click', ()=>{
  const icon=playPauseBtn.querySelector('i');
  if(!isPlaying){ isPlaying=true; icon.classList.remove('fa-play'); icon.classList.add('fa-pause'); startAutoPlay(); }
  else stopAutoOnInteraction();
});

function calculateDelay(text) {
  // remove spaces, count chars
  const charCount = text.replace(/\s+/g, '').length;
  // minimum 2s so short cards don’t skip instantly
  return Math.max(2000, charCount * 100) + 2;  // 2 sec for thinking
}

function startAutoPlay(){
  autoIndex = currentIndex;
  showingAnswer = false;
  renderFlashcards();
  const card = flashcards[autoIndex];
  const delay = calculateDelay(card.question);
  playInterval = setTimeout(autoPlayStep, delay);
}

function autoPlayStep(){
  const cardInner = document.querySelector('.card-inner');
  if(!cardInner) return;

  cardInner.classList.toggle('flipped');
  showingAnswer = !showingAnswer;

  const card = flashcards[autoIndex];
  let delay;

  if(showingAnswer){
    delay = calculateDelay(card.answer); // show answer
  } else {
    if(autoIndex < flashcards.length - 1){
      autoIndex++;
      currentIndex = autoIndex;
      seenCount = Math.max(seenCount, currentIndex);
      renderFlashcards();
      delay = calculateDelay(flashcards[autoIndex].question); // next question
    } else {
      stopAutoOnInteraction();
      return;
    }
  }

  playInterval = setTimeout(autoPlayStep, delay);
}

// Essentials/Details toggle
modeToggle.addEventListener('change', ()=>{ stopAutoOnInteraction(); loadChapter(originalChapterKey); });

function loadChapter(chapterKey){
  const jsonURL=(modeToggle.checked ? chapterJSONMap_details[chapterKey] : chapterJSONMap_essentials[chapterKey]);
  if(!jsonURL){ console.error("Invalid chapter:",chapterKey); return; }
  fetch(jsonURL).then(res=>res.json()).then(data=>{
    flashcards=data; currentIndex=0; flippedCards={}; seenCount=0; totalFlashcards=flashcards.length; autoIndex=0; showingAnswer=false;
    renderFlashcards();
  }).catch(err=>{
    console.error(err); flashcards=[{id:1,question:"Sample Question?",answer:"Sample Answer"}]; currentIndex=0; flippedCards={}; seenCount=0; totalFlashcards=flashcards.length; autoIndex=0; showingAnswer=false;
    renderFlashcards();
  });
}

// Render flashcards
function renderFlashcards(){
  container.innerHTML='';
  if(flashcards.length===0){ progressBar.style.width='0%'; progressText.textContent='0/0'; return; }
  const progressPercent=((currentIndex + 1)/totalFlashcards)*100; progressBar.style.width=progressPercent+'%';
  progressText.textContent=`${currentIndex+1}/${totalFlashcards}`;
  const card=flashcards[currentIndex]; flippedCards[card.id]=false;
  const wrapper=document.createElement('div'); wrapper.style.display='flex'; wrapper.style.flexDirection='column'; wrapper.style.alignItems='center';
  const cardEl=document.createElement('div'); cardEl.classList.add('card');
  if(activeTab==='questions'){
    const inner=document.createElement('div'); inner.classList.add('card-inner');
    const front=document.createElement('div'); front.classList.add('card-front'); front.innerHTML=`<div><strong>QUESTION</strong></div><div>${card.question}</div>`;
    const back=document.createElement('div'); back.classList.add('card-back'); back.innerHTML=`<div><strong>ANSWER</strong></div><div>${card.answer}</div>`;
    inner.appendChild(front); inner.appendChild(back); cardEl.appendChild(inner);
    cardEl.addEventListener('click',()=>{ stopAutoOnInteraction(); flippedCards[card.id]=!flippedCards[card.id]; inner.classList.toggle('flipped'); });
  } else {
    const textareaContainer=document.createElement('div'); textareaContainer.classList.add('textarea-container');
    const qDiv=document.createElement('div'); qDiv.innerHTML=`<strong>QUESTION:</strong> ${card.question}`; qDiv.classList.add('note-question');
    const textarea=document.createElement('textarea'); textarea.value=card.answer || ""; textarea.classList.add('note-textarea');
    textarea.addEventListener('input', e=>{ card.answer=e.target.value; if(flippedCards[card.id]) renderFlashcards(); });
    textareaContainer.appendChild(qDiv); textareaContainer.appendChild(textarea); cardEl.appendChild(textareaContainer);
  }
  wrapper.appendChild(cardEl);

  const nav=document.createElement('div'); nav.classList.add('nav-buttons');
  const prevBtn=document.createElement('button'); prevBtn.innerHTML='&#10094;'; prevBtn.disabled=currentIndex===0; prevBtn.onclick=()=>{ stopAutoOnInteraction(); if(currentIndex>0){ currentIndex--; renderFlashcards(); } };
  const nextBtn=document.createElement('button'); nextBtn.innerHTML='&#10095;'; nextBtn.disabled=currentIndex===flashcards.length-1; nextBtn.onclick=()=>{ stopAutoOnInteraction(); if(currentIndex<flashcards.length-1){ currentIndex++; renderFlashcards(); seenCount=Math.max(seenCount,currentIndex); } };
  nav.appendChild(prevBtn); nav.appendChild(nextBtn); wrapper.appendChild(nav);

  container.appendChild(wrapper);
}

// Tabs
questionsTab.addEventListener('click',()=>{ stopAutoOnInteraction(); activeTab='questions'; questionsTab.classList.add('active'); notesTab.classList.remove('active'); renderFlashcards(); });
notesTab.addEventListener('click',()=>{ stopAutoOnInteraction(); activeTab='notes'; notesTab.classList.add('active'); questionsTab.classList.remove('active'); renderFlashcards(); });
</script>
</body>
</html>


