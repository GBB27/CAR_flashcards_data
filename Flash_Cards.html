<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flashcard Quiz</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(to bottom right, #dbeafe, #e0e7ff);
    margin: 0;
    padding: 20px;
  }

  h1 {
    text-align: center;
    margin: 20px;
    font-size: 2rem;
    color: #333;
  }

  p {
    text-align: center;
    color: #4b5563;
    margin-top: 0;
  }

  /* Collapsible sidebar */
  .sidebar {
    position: fixed;
    top: 100px;
    left: 0;
    width: 160px;
    background: #fff;
    padding: 15px;
    border-radius: 0 8px 8px 0;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transform: translateX(calc(-100% - 15px));
    transition: transform 0.3s ease;
    z-index: 9999;
  }

  .sidebar.open {
    transform: translateX(0);
  }

  .sidebar h2 {
    font-size: 1.2rem;
    margin-top: 0;
    color: #4a4ca8;
    text-align: center;
  }

  .sidebar ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .sidebar li {
    margin: 8px 0;
  }

  .sidebar a {
    text-decoration: none;
    color: #111827;
    transition: color 0.2s;
  }

  .sidebar a:hover,
  .sidebar a.active-chapter {
    color: #6366f1;
    font-weight: bold;
  }

  .sidebar-toggle {
    position: fixed;
    top: 110px;
    left: 0;
    background: #4a4ca8;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    z-index: 10000;
    border-radius: 0 5px 5px 0;
  }

  /* Tabs */
  .tabs {
    margin: 20px;
    display: flex;
    justify-content: center;
    gap: 10px;
  }

  .tabs button {
    padding: 10px 20px;
    cursor: pointer;
    border: none;
    background: white;
    border-radius: 5px;
    transition: background 0.3s;
  }

  .tabs button.active {
    background: #4a4ca8;
    color: #fff;
  }

  /* Flashcards container */
  .container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 300px;
    width: 100%;
    flex-direction: column;
  }

  .card {
    width: 300px;
    height: 200px;
  }

  .card-inner {
    position: relative;
    width: 100%;
    height: 180px;
    transition: transform 0.45s;
    transform-style: preserve-3d;
    border-radius: 10px;
    cursor: pointer;
  }

  .card-inner.flipped {
    transform: rotateY(180deg);
  }

  .card-front, .card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 15px;
    box-sizing: border-box;
    font-size: 16px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  .card-front {
    background-color: #6366f1;
    color: white;
    flex-direction: column;
  }

  .card-back {
    background-color: white;
    color: #111827;
    transform: rotateY(180deg);
    flex-direction: column;
  }

  .textarea-container {
    display: flex;
    flex-direction: column;
    width: 300px;
    margin: auto;
  }

  textarea {
    margin-top: 10px;
    height: 100px;
    resize: none;
  }

  .nav-buttons {
    margin-top: 20px;
    text-align: center;
  }

  .nav-buttons button {
    padding: 10px 15px;
    margin: 0 5px;
    border: none;
    background: #333;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
  }

  .nav-buttons button:disabled {
    background: #aaa;
    cursor: not-allowed;
  }

  /* Shuffle button */
  #shuffleBtn {
    margin: 10px auto;
    display: block;
    padding: 8px 12px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    background-color: #4a4ca8;
    color: white;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>Capital Adequacy Requirements (CAR) - Guideline (2024)</h1>
<p>Flip cards to reveal answers or edit them in the Notes tab</p>

<button class="sidebar-toggle" id="sidebarToggle">☰</button>
<div class="sidebar" id="sidebar">
  <h2>Chapters</h2>
  <ul>
    <li><a href="#chapter1">Chapter 1 – Overview</a></li>
    <li><a href="#chapter2">Chapter 2 – Definition of Capital</a></li>
    <li><a href="#chapter3">Chapter 3 – Operational Risk</a></li>
    <li><a href="#chapter4">Chapter 4 – Credit Risk – Standardized Approach</a></li>
    <li><a href="#chapter5">Chapter 5 – Credit Risk – Internal Ratings-Based Approach</a></li>
    <li><a href="#chapter6">Chapter 6 – Securitization</a></li>
    <li><a href="#chapter7">Chapter 7 – Settlement and Counterparty Risk</a></li>
    <li><a href="#chapter8">Chapter 8 – CVA Risk</a></li>
    <li><a href="#chapter9">Chapter 9 – Market Risk</a></li>
  </ul>
</div>

<div class="tabs">
  <button id="questionsTab" class="active">Questions Mode</button>
  <button id="notesTab">Notes Mode</button>
</div>

<!-- Shuffle button -->
<button id="shuffleBtn">Shuffle Flashcards</button>

<div class="container" id="flashcards-container"></div>

<script>
const container = document.getElementById('flashcards-container');
const questionsTab = document.getElementById('questionsTab');
const notesTab = document.getElementById('notesTab');
const sidebar = document.getElementById('sidebar');
const toggleBtn = document.getElementById('sidebarToggle');
const shuffleBtn = document.getElementById('shuffleBtn');

let flashcards = [];
let activeTab = 'questions';
let flippedCards = {};
let currentIndex = 0;

// Mapping chapters to raw GitHub JSON URLs
const chapterJSONMap = {
  chapter1: "https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter1.json",
  chapter2: "https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter2.json",
  chapter3: "https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter3.json",
  chapter4: "https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter4.json",
  chapter5: "https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter5.json",
  chapter6: "https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter6.json",
  chapter7: "https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter7.json",
  chapter8: "https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter8.json",
  chapter9: "https://raw.githubusercontent.com/GBB27/CAR_flashcards_data/main/chapter9.json"
};

// Toggle sidebar
toggleBtn.addEventListener('click', () => {
  sidebar.classList.toggle('open');
});

// Load default chapter
loadChapter('chapter1');

// Sidebar click events
const sidebarLinks = document.querySelectorAll('.sidebar a');
sidebarLinks.forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    const chapterId = link.getAttribute('href').substring(1);

    // Highlight active chapter
    sidebarLinks.forEach(l => l.classList.remove('active-chapter'));
    link.classList.add('active-chapter');

    // Load the selected chapter
    loadChapter(chapterId);

    // Automatically close the sidebar
    sidebar.classList.remove('open');
  });
});

// Shuffle function
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// Shuffle button click
shuffleBtn.addEventListener('click', () => {
  shuffleArray(flashcards);
  currentIndex = 0;
  flippedCards = {};
  renderFlashcards();
});

function loadChapter(chapterKey) {
  const jsonURL = chapterJSONMap[chapterKey];
  if (!jsonURL) {
    console.error("Invalid chapter:", chapterKey);
    return;
  }

  fetch(jsonURL)
    .then(res => res.json())
    .then(data => {
      flashcards = data;
      currentIndex = 0;
      flippedCards = {};
      renderFlashcards();
    })
    .catch(err => {
      console.error("Error loading chapter:", err);
      flashcards = [
        { id: 1, question: "Sample Question?", answer: "Sample Answer" }
      ];
      currentIndex = 0;
      flippedCards = {};
      renderFlashcards();
    });
}

function renderFlashcards() {
  container.innerHTML = '';

  if (flashcards.length === 0) {
    container.textContent = "No flashcards available.";
    return;
  }

  const card = flashcards[currentIndex];
  flippedCards[card.id] = flippedCards[card.id] || false;

  const wrapper = document.createElement('div');
  wrapper.style.display = 'flex';
  wrapper.style.flexDirection = 'column';
  wrapper.style.alignItems = 'center';

  const cardEl = document.createElement('div');
  cardEl.classList.add('card');

  if (activeTab === 'questions') {
    const inner = document.createElement('div');
    inner.classList.add('card-inner');
    if (flippedCards[card.id]) inner.classList.add('flipped');

    const front = document.createElement('div');
    front.classList.add('card-front');
    front.innerHTML = `<div><strong>QUESTION</strong></div><div>${card.question}</div>`;

    const back = document.createElement('div');
    back.classList.add('card-back');
    back.innerHTML = `<div><strong>ANSWER</strong></div><div>${card.answer}</div>`;

    inner.appendChild(front);
    inner.appendChild(back);
    cardEl.appendChild(inner);

    cardEl.addEventListener('click', () => {
      flippedCards[card.id] = !flippedCards[card.id];
      inner.classList.toggle('flipped');
    });
  } else {
    const textareaContainer = document.createElement('div');
    textareaContainer.classList.add('textarea-container');
    const qDiv = document.createElement('div');
    qDiv.innerHTML = `<strong>QUESTION:</strong> ${card.question}`;
    const textarea = document.createElement('textarea');
    textarea.value = card.answer;
    textarea.addEventListener('input', e => {
      card.answer = e.target.value;
      if (flippedCards[card.id]) renderFlashcards();
    });
    textareaContainer.appendChild(qDiv);
    textareaContainer.appendChild(textarea);
    cardEl.appendChild(textareaContainer);
  }

  wrapper.appendChild(cardEl);

  const nav = document.createElement('div');
  nav.classList.add('nav-buttons');

  const prevBtn = document.createElement('button');
  prevBtn.textContent = "Previous";
  prevBtn.disabled = currentIndex === 0;
  prevBtn.onclick = () => { if (currentIndex > 0) { currentIndex--; renderFlashcards(); } };

  const nextBtn = document.createElement('button');
  nextBtn.textContent = "Next";
  nextBtn.disabled = currentIndex === flashcards.length - 1;
  nextBtn.onclick = () => { if (currentIndex < flashcards.length - 1) { currentIndex++; renderFlashcards(); } };

  nav.appendChild(prevBtn);
  nav.appendChild(nextBtn);
  wrapper.appendChild(nav);

  container.appendChild(wrapper);
}

questionsTab.addEventListener('click', () => {
  activeTab = 'questions';
  questionsTab.classList.add('active');
  notesTab.classList.remove('active');
  renderFlashcards();
});

notesTab.addEventListener('click', () => {
  activeTab = 'notes';
  notesTab.classList.add('active');
  questionsTab.classList.remove('active');
  renderFlashcards();
});
</script>

</body>
</html>

